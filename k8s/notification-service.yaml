apiVersion: v1
kind: ConfigMap
metadata:
  name: notification-service-config
  namespace: demo
data:
  endpoints.json: |
    {
      "info": {
        "title": "Notification Service API",
        "description": "Mock notification service for ecommerce platform (email, SMS, push)",
        "version": "1.0.0"
      },
      "endpoints": [
        {
          "path": "/api/notifications",
          "method": "GET",
          "statusCode": 200,
          "summary": "Get user notifications",
          "tags": ["Notifications"],
          "response": {
            "notifications": [
              {"id": "notif-001", "type": "order", "title": "Order Shipped!", "message": "Your order ORD-2024-003 has been shipped", "read": false, "createdAt": "2024-01-20T14:00:00Z"},
              {"id": "notif-002", "type": "promotion", "title": "Flash Sale!", "message": "50% off on electronics today only", "read": false, "createdAt": "2024-01-20T09:00:00Z"},
              {"id": "notif-003", "type": "order", "title": "Order Confirmed", "message": "Your order ORD-2024-003 has been confirmed", "read": true, "createdAt": "2024-01-20T09:16:00Z"}
            ],
            "unreadCount": 2,
            "pagination": {"page": 1, "perPage": 10, "total": 3}
          }
        },
        {
          "path": "/api/notifications/{id}/read",
          "method": "POST",
          "statusCode": 200,
          "summary": "Mark notification as read",
          "tags": ["Notifications"],
          "response": {
            "id": "notif-001",
            "read": true,
            "message": "Notification marked as read"
          }
        },
        {
          "path": "/api/notifications/read-all",
          "method": "POST",
          "statusCode": 200,
          "summary": "Mark all notifications as read",
          "tags": ["Notifications"],
          "response": {
            "message": "All notifications marked as read",
            "count": 2
          }
        },
        {
          "path": "/api/notifications/send",
          "method": "POST",
          "statusCode": 201,
          "summary": "Send notification",
          "tags": ["Notifications"],
          "response": {
            "id": "notif-004",
            "status": "sent",
            "channels": ["email", "push"],
            "message": "Notification sent successfully"
          }
        },
        {
          "path": "/api/notifications/email",
          "method": "POST",
          "statusCode": 201,
          "summary": "Send email notification",
          "tags": ["Email"],
          "response": {
            "messageId": "msg-2024-001",
            "status": "queued",
            "recipient": "user@example.com",
            "template": "order_confirmation"
          }
        },
        {
          "path": "/api/notifications/sms",
          "method": "POST",
          "statusCode": 201,
          "summary": "Send SMS notification",
          "tags": ["SMS"],
          "response": {
            "messageId": "sms-2024-001",
            "status": "sent",
            "recipient": "+1234567890",
            "message": "Your order has been shipped!"
          }
        },
        {
          "path": "/api/notifications/preferences",
          "method": "GET",
          "statusCode": 200,
          "summary": "Get notification preferences",
          "tags": ["Preferences"],
          "response": {
            "userId": "user-001",
            "preferences": {
              "email": {"orderUpdates": true, "promotions": true, "newsletter": false},
              "sms": {"orderUpdates": true, "promotions": false},
              "push": {"orderUpdates": true, "promotions": true, "priceDrops": true}
            }
          }
        },
        {
          "path": "/api/notifications/preferences",
          "method": "PUT",
          "statusCode": 200,
          "summary": "Update notification preferences",
          "tags": ["Preferences"],
          "response": {
            "message": "Preferences updated successfully"
          }
        },
        {
          "path": "/api/notifications/templates",
          "method": "GET",
          "statusCode": 200,
          "summary": "List notification templates",
          "tags": ["Templates"],
          "response": {
            "templates": [
              {"id": "order_confirmation", "name": "Order Confirmation", "channels": ["email", "push"]},
              {"id": "shipping_update", "name": "Shipping Update", "channels": ["email", "sms", "push"]},
              {"id": "password_reset", "name": "Password Reset", "channels": ["email"]},
              {"id": "promotion", "name": "Promotional", "channels": ["email", "push"]}
            ]
          }
        }
      ]
    }
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: notification-service
  namespace: demo
spec:
  replicas: 1
  selector:
    matchLabels:
      app: notification-service
  template:
    metadata:
      labels:
        app: notification-service
    spec:
      containers:
      - name: notification-service
        image: ghcr.io/serviceweave/stubber:main
        ports:
        - containerPort: 8080
        volumeMounts:
        - name: config
          mountPath: /config
        readinessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 2
          periodSeconds: 5
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 10
        resources:
          requests:
            memory: "8Mi"
            cpu: "10m"
          limits:
            memory: "32Mi"
            cpu: "100m"
      volumes:
      - name: config
        configMap:
          name: notification-service-config
---
apiVersion: v1
kind: Service
metadata:
  name: notification-service
  namespace: demo
spec:
  selector:
    app: notification-service
  ports:
  - port: 80
    targetPort: 8080
